{% liquid
  assign sid = 'gift-guide-banner-' | append: section.id
%}

<section id="{{ sid }}" class="ggb">
  <div class="ggb__top">
    {% for block in section.blocks %}
      {% if block.type == 'top_box' %}
        {% liquid
          assign is_button = block.settings.is_button
          assign top_tag = 'div'
          if is_button and block.settings.link != blank
            assign top_tag = 'a'
          endif
        %}
        <{{ top_tag }}
          class="ggb__box ggb__top-box ggb__top-box--{{ block.settings.align }} {% if is_button %}ggb__top-box--button{% endif %}"
          {% if top_tag == 'a' %}href="{{ block.settings.link }}"{% endif %}
          {{ block.shopify_attributes }}
          style="
            --box-bg: {{ block.settings.box_bg }};
            --box-text: {{ block.settings.text_color }};
            --box-border: {{ block.settings.border_color }};
            --box-border-w: {{ block.settings.border_width }}px;
            --box-pad-y: {{ block.settings.padding_y }}px;
            --box-pad-x: {{ block.settings.padding_x }}px;
            --box-font: {{ block.settings.font_size }}px;
          "
        >
          <span>{{ block.settings.text }}</span>
          {% if is_button and block.settings.show_arrow %}
            <span class="ggb__arrow">→</span>
          {% endif %}
        </{{ top_tag }}>
      {% endif %}
    {% endfor %}
  </div>

  <div class="ggb__hero">
    <div class="ggb__inner">
      {% for block in section.blocks %}
        {% case block.type %}
          {% when 'title_box' %}
            <div
              class="ggb__box ggb__title"
              {{ block.shopify_attributes }}
              style="
                --box-bg: {{ block.settings.box_bg }};
                --box-text: {{ block.settings.text_color }};
                --box-border: {{ block.settings.border_color }};
                --box-border-w: {{ block.settings.border_width }}px;
                --box-pad-y: {{ block.settings.padding_y }}px;
                --box-pad-x: {{ block.settings.padding_x }}px;
                --box-font: {{ block.settings.font_size }}px;
              "
            >
              {{ block.settings.text }}
            </div>

          {% when 'text_box' %}
            <div
              class="ggb__box ggb__desc"
              {{ block.shopify_attributes }}
              style="
                --box-bg: {{ block.settings.box_bg }};
                --box-text: {{ block.settings.text_color }};
                --box-border: {{ block.settings.border_color }};
                --box-border-w: {{ block.settings.border_width }}px;
                --box-pad-y: {{ block.settings.padding_y }}px;
                --box-pad-x: {{ block.settings.padding_x }}px;
                --box-font: {{ block.settings.font_size }}px;
              "
            >
              {{ block.settings.text }}
            </div>

          {% when 'cta_box' %}
            <div
              class="ggb__box ggb__cta-wrap"
              {{ block.shopify_attributes }}
              style="
                --box-bg: {{ block.settings.frame_bg }};
                --box-border: {{ block.settings.border_color }};
                --box-border-w: {{ block.settings.border_width }}px;
                --box-pad-y: {{ block.settings.padding_y }}px;
                --box-pad-x: {{ block.settings.padding_x }}px;
              "
            >
              <a class="ggb__cta" href="{{ block.settings.link | default: '#' }}">
                <span
                  class="ggb__cta-text"
                  style="
                    --cta-bg: {{ block.settings.button_bg }};
                    --cta-text: {{ block.settings.button_text }};
                    --cta-font: {{ block.settings.font_size }}px;
                  "
                >
                  {{ block.settings.text }}
                </span>
                {% if block.settings.show_arrow %}
                  <span class="ggb__cta-arrow" style="--cta-bg: {{ block.settings.button_bg }}; --cta-text: {{ block.settings.button_text }};">→</span>
                {% endif %}
              </a>
            </div>
        {% endcase %}
      {% endfor %}
    </div>
  </div>

  <div class="ggb__bottom">
    {% for block in section.blocks %}
      {% if block.type == 'bottom_box' %}
        <div
          class="ggb__box ggb__bottom-box"
          {{ block.shopify_attributes }}
          style="
            --box-bg: {{ block.settings.box_bg }};
            --box-text: {{ block.settings.text_color }};
            --box-border: {{ block.settings.border_color }};
            --box-border-w: {{ block.settings.border_width }}px;
            --box-pad-y: {{ block.settings.padding_y }}px;
            --box-pad-x: {{ block.settings.padding_x }}px;
            --box-font: {{ block.settings.font_size }}px;
          "
        >
          {{ block.settings.text }}
        </div>
      {% endif %}
    {% endfor %}
  </div>
</section>

<style>
  #{{ sid }} {
    --bg: {{ section.settings.bg_color }};
    --top-bg: {{ section.settings.topbar_bg }};
    --content-max: {{ section.settings.content_max_width }}px;
    --content-top: {{ section.settings.content_offset_top_desktop }}px;
    --content-left: {{ section.settings.content_offset_left_desktop }}px;
    --hero-min: {{ section.settings.hero_height_desktop }}vh;
    background: var(--bg);
    position: relative;
    overflow: hidden;
  }

  #{{ sid }} .ggb__top {
    min-height: 72px;
    background: var(--top-bg);
    border-bottom: 1px solid #dcdcdc;
    display: grid;
    grid-template-columns: 1fr auto 1fr;
    gap: 20px;
    align-items: center;
    padding: 8px clamp(16px, 3vw, 48px);
  }

  #{{ sid }} .ggb__top-box--left { justify-self: start; }
  #{{ sid }} .ggb__top-box--center { justify-self: center; }
  #{{ sid }} .ggb__top-box--right { justify-self: end; }

  #{{ sid }} .ggb__hero {
    min-height: var(--hero-min);
    {% if section.settings.bg_image != blank %}
      background-image: url('{{ section.settings.bg_image | image_url: width: 3000 }}');
    {% endif %}
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    position: relative;
  }

  #{{ sid }} .ggb__inner {
    max-width: var(--content-max);
    margin: 0 auto;
    padding: var(--content-top) 16px 90px;
    transform: translateX(var(--content-left));
    display: grid;
    gap: 16px;
    justify-items: start;
  }

  #{{ sid }} .ggb__bottom {
    position: absolute;
    left: 50%;
    bottom: 8px;
    transform: translateX(-50%);
    z-index: 3;
  }

  #{{ sid }} .ggb__box {
    background: var(--box-bg, #fff);
    color: var(--box-text, #111);
    border: var(--box-border-w, 4px) solid var(--box-border, #ff2020);
    padding: var(--box-pad-y, 10px) var(--box-pad-x, 16px);
    font-size: var(--box-font, 20px);
    line-height: 1.2;
  }

  #{{ sid }} .ggb__top-box {
    white-space: nowrap;
    display: inline-flex;
    align-items: center;
    gap: 16px;
    text-decoration: none;
  }

  #{{ sid }} .ggb__top-box--button .ggb__arrow { margin-left: 4px; }

  #{{ sid }} .ggb__title { font-weight: 700; line-height: 1; }
  #{{ sid }} .ggb__desc { max-width: 640px; }

  #{{ sid }} .ggb__cta-wrap { background: var(--box-bg, #fff); padding: var(--box-pad-y, 14px) var(--box-pad-x, 14px); }
  #{{ sid }} .ggb__cta {
    text-decoration: none;
    display: inline-flex;
    align-items: stretch;
    color: inherit;
  }
  #{{ sid }} .ggb__cta-text,
  #{{ sid }} .ggb__cta-arrow {
    background: var(--cta-bg, #000);
    color: var(--cta-text, #fff);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-height: 54px;
    font-size: var(--cta-font, 24px);
    line-height: 1;
    padding: 0 22px;
  }
  #{{ sid }} .ggb__cta-arrow { width: 54px; padding: 0; }

  #{{ sid }} .ggb__bottom-box { white-space: nowrap; }

  @media (max-width: 1200px) {
    #{{ sid }} .ggb__top {
      grid-template-columns: 1fr;
      justify-items: center;
      gap: 10px;
      padding: 12px;
    }
    #{{ sid }} .ggb__top-box--left,
    #{{ sid }} .ggb__top-box--center,
    #{{ sid }} .ggb__top-box--right {
      justify-self: center;
      white-space: normal;
      text-align: center;
    }
    #{{ sid }} .ggb__inner {
      transform: none;
      padding-top: {{ section.settings.content_offset_top_mobile }}px;
    }
  }

  @media (max-width: 749px) {
    #{{ sid }} {
      --hero-min: {{ section.settings.hero_height_mobile }}vh;
    }
    #{{ sid }} .ggb__hero {
      background-position: center top;
    }
    #{{ sid }} .ggb__inner {
      gap: 12px;
      padding-left: 12px;
      padding-right: 12px;
      padding-bottom: 72px;
    }
    #{{ sid }} .ggb__desc { max-width: 100%; }
    #{{ sid }} .ggb__bottom {
      bottom: 6px;
      width: calc(100% - 20px);
      display: flex;
      justify-content: center;
    }
    #{{ sid }} .ggb__bottom-box {
      max-width: 100%;
      overflow: hidden;
      text-overflow: ellipsis;
    }
  }
</style>

<script>
  (function () {
    var root = document.getElementById('{{ sid }}');
    if (!root) return;

    function mobileVh() {
      root.style.setProperty('--vvh', window.innerHeight * 0.01 + 'px');
    }

    mobileVh();
    window.addEventListener('resize', mobileVh, { passive: true });
  })();
</script>

{% schema %}
{
  "name": "Gift Guide Banner",
  "settings": [
    { "type": "image_picker", "id": "bg_image", "label": "Background image" },
    { "type": "color", "id": "bg_color", "label": "Background fallback", "default": "#e9e9e9" },
    { "type": "color", "id": "topbar_bg", "label": "Top bar background", "default": "#f1f1f1" },

    { "type": "range", "id": "hero_height_desktop", "label": "Hero height desktop (vh)", "min": 50, "max": 100, "step": 5, "default": 85 },
    { "type": "range", "id": "hero_height_mobile", "label": "Hero height mobile (vh)", "min": 50, "max": 100, "step": 5, "default": 80 },

    { "type": "range", "id": "content_max_width", "label": "Content max width", "min": 500, "max": 1400, "step": 20, "default": 1200 },
    { "type": "range", "id": "content_offset_top_desktop", "label": "Content top offset desktop", "min": 0, "max": 400, "step": 10, "default": 280 },
    { "type": "range", "id": "content_offset_left_desktop", "label": "Content left offset desktop", "min": -300, "max": 300, "step": 10, "default": -220 },
    { "type": "range", "id": "content_offset_top_mobile", "label": "Content top offset mobile", "min": 0, "max": 220, "step": 10, "default": 120 }
  ],
  "blocks": [
    {
      "type": "top_box",
      "name": "Top red box",
      "limit": 3,
      "settings": [
        { "type": "text", "id": "text", "label": "Text", "default": "TISSO VISON" },
        {
          "type": "select",
          "id": "align",
          "label": "Position",
          "default": "left",
          "options": [
            { "value": "left", "label": "Left" },
            { "value": "center", "label": "Center" },
            { "value": "right", "label": "Right" }
          ]
        },
        { "type": "checkbox", "id": "is_button", "label": "Make this a button", "default": false },
        { "type": "url", "id": "link", "label": "Button link" },
        { "type": "checkbox", "id": "show_arrow", "label": "Show arrow", "default": false },

        { "type": "color", "id": "box_bg", "label": "Background", "default": "#ffffff" },
        { "type": "color", "id": "text_color", "label": "Text color", "default": "#111111" },
        { "type": "color", "id": "border_color", "label": "Border color", "default": "#ff1f1f" },
        { "type": "range", "id": "border_width", "label": "Border width", "min": 1, "max": 8, "step": 1, "default": 4 },
        { "type": "range", "id": "padding_y", "label": "Padding Y", "min": 4, "max": 24, "step": 1, "default": 12 },
        { "type": "range", "id": "padding_x", "label": "Padding X", "min": 8, "max": 40, "step": 1, "default": 18 },
        { "type": "range", "id": "font_size", "label": "Font size", "min": 12, "max": 72, "step": 1, "default": 28 }
      ]
    },
    {
      "type": "title_box",
      "name": "Main title box",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "text", "label": "Title", "default": "The Gift Guide" },
        { "type": "color", "id": "box_bg", "label": "Background", "default": "#ffffff" },
        { "type": "color", "id": "text_color", "label": "Text color", "default": "#111111" },
        { "type": "color", "id": "border_color", "label": "Border color", "default": "#ff1f1f" },
        { "type": "range", "id": "border_width", "label": "Border width", "min": 1, "max": 8, "step": 1, "default": 4 },
        { "type": "range", "id": "padding_y", "label": "Padding Y", "min": 4, "max": 24, "step": 1, "default": 10 },
        { "type": "range", "id": "padding_x", "label": "Padding X", "min": 8, "max": 40, "step": 1, "default": 16 },
        { "type": "range", "id": "font_size", "label": "Font size", "min": 24, "max": 120, "step": 1, "default": 82 }
      ]
    },
    {
      "type": "text_box",
      "name": "Description box",
      "limit": 1,
      "settings": [
        { "type": "textarea", "id": "text", "label": "Description", "default": "Discover Joy: Your Ultimate Holiday Gift Destination. Explore our curated selection and find the perfect gifts to delight your loved ones this holiday season." },
        { "type": "color", "id": "box_bg", "label": "Background", "default": "#ffffff" },
        { "type": "color", "id": "text_color", "label": "Text color", "default": "#111111" },
        { "type": "color", "id": "border_color", "label": "Border color", "default": "#ff1f1f" },
        { "type": "range", "id": "border_width", "label": "Border width", "min": 1, "max": 8, "step": 1, "default": 4 },
        { "type": "range", "id": "padding_y", "label": "Padding Y", "min": 4, "max": 24, "step": 1, "default": 10 },
        { "type": "range", "id": "padding_x", "label": "Padding X", "min": 8, "max": 40, "step": 1, "default": 14 },
        { "type": "range", "id": "font_size", "label": "Font size", "min": 12, "max": 60, "step": 1, "default": 22 }
      ]
    },
    {
      "type": "cta_box",
      "name": "Shop button box",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "text", "label": "Button text", "default": "SHOP NOW" },
        { "type": "url", "id": "link", "label": "Button link" },
        { "type": "checkbox", "id": "show_arrow", "label": "Show arrow", "default": true },

        { "type": "color", "id": "frame_bg", "label": "Outer frame background", "default": "#ffffff" },
        { "type": "color", "id": "border_color", "label": "Outer frame border", "default": "#ff1f1f" },
        { "type": "range", "id": "border_width", "label": "Outer border width", "min": 1, "max": 8, "step": 1, "default": 4 },
        { "type": "range", "id": "padding_y", "label": "Outer padding Y", "min": 4, "max": 20, "step": 1, "default": 12 },
        { "type": "range", "id": "padding_x", "label": "Outer padding X", "min": 4, "max": 20, "step": 1, "default": 12 },

        { "type": "color", "id": "button_bg", "label": "Inner button background", "default": "#000000" },
        { "type": "color", "id": "button_text", "label": "Inner button text", "default": "#ffffff" },
        { "type": "range", "id": "font_size", "label": "Button font size", "min": 12, "max": 48, "step": 1, "default": 30 }
      ]
    },
    {
      "type": "bottom_box",
      "name": "Bottom text box",
      "limit": 1,
      "settings": [
        { "type": "text", "id": "text", "label": "Bottom text", "default": "SUSTAINABLE, ETHICALLY MADE CLOTHES IN SIZES XXS TO 6XL" },
        { "type": "color", "id": "box_bg", "label": "Background", "default": "#ffffff" },
        { "type": "color", "id": "text_color", "label": "Text color", "default": "#111111" },
        { "type": "color", "id": "border_color", "label": "Border color", "default": "#ff1f1f" },
        { "type": "range", "id": "border_width", "label": "Border width", "min": 1, "max": 8, "step": 1, "default": 4 },
        { "type": "range", "id": "padding_y", "label": "Padding Y", "min": 2, "max": 14, "step": 1, "default": 4 },
        { "type": "range", "id": "padding_x", "label": "Padding X", "min": 6, "max": 30, "step": 1, "default": 10 },
        { "type": "range", "id": "font_size", "label": "Font size", "min": 10, "max": 32, "step": 1, "default": 14 }
      ]
    }
  ],
  "presets": [
    {
      "name": "Gift Guide Banner (Editor)",
      "blocks": [
        { "type": "top_box", "settings": { "text": "TISSO VISON", "align": "left", "font_size": 56 } },
        { "type": "top_box", "settings": { "text": "Find the ideal gift for your loved ones.", "align": "center", "font_size": 42 } },
        { "type": "top_box", "settings": { "text": "CHOOSE GIFT", "align": "right", "is_button": true, "show_arrow": true, "box_bg": "#f0ea35", "font_size": 42 } },
        { "type": "title_box" },
        { "type": "text_box" },
        { "type": "cta_box" },
        { "type": "bottom_box" }
      ]
    }
  ]
}
{% endschema %}