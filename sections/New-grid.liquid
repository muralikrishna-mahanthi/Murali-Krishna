{% liquid
  assign source_collection = section.settings.collection
  if source_collection == blank
    assign source_collection = collections['all']
  endif
%}

<section class="wild-grid-products">
  <div class="wild-grid-products__container">
    {% if section.settings.heading != blank %}
      <h2 class="wild-grid-products__heading">{{ section.settings.heading }}</h2>
    {% endif %}

    <div class="wild-grid-products__grid js-wild-grid-products">
      {% assign rendered_count = 0 %}

      {% if source_collection != blank %}
        {% for product in source_collection.products limit: 6 %}
          <article class="wild-grid-products__item js-wild-grid-item">
            <a class="wild-grid-products__link" href="{{ product.url }}" aria-label="{{ product.title | escape }}">
              {% if product.featured_image != blank %}
                <img
                  class="wild-grid-products__image"
                  src="{{ product.featured_image | image_url: width: 900 }}"
                  alt="{{ product.featured_image.alt | default: product.title | escape }}"
                  width="{{ product.featured_image.width }}"
                  height="{{ product.featured_image.height }}"
                  loading="lazy"
                >
              {% else %}
                {{ 'product-1' | placeholder_svg_tag: 'wild-grid-products__image wild-grid-products__image--placeholder' }}
              {% endif %}
              <span class="wild-grid-products__plus" aria-hidden="true">+</span>
            </a>
          </article>
          {% assign rendered_count = rendered_count | plus: 1 %}
        {% endfor %}
      {% endif %}

      {% if rendered_count < 6 %}
        {% for i in (rendered_count..5) %}
          <article class="wild-grid-products__item js-wild-grid-item wild-grid-products__item--empty">
            <div class="wild-grid-products__link" role="img" aria-label="Placeholder image">
              {{ 'product-1' | placeholder_svg_tag: 'wild-grid-products__image wild-grid-products__image--placeholder' }}
              <span class="wild-grid-products__plus" aria-hidden="true">+</span>
            </div>
          </article>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</section>

<style>
  .wild-grid-products {
    background: #ededed;
    padding: 48px 0;
  }

  .wild-grid-products__container {
    width: min(1240px, calc(100% - 48px));
    margin: 0 auto;
  }

  .wild-grid-products__heading {
    margin: 0 0 26px;
    color: #111;
    font-size: clamp(30px, 3.2vw, 52px);
    font-weight: 400;
    line-height: 1.1;
  }

  .wild-grid-products__grid {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    grid-template-rows: repeat(2, auto);
    gap: 18px;
  }

  .wild-grid-products__item {
    overflow: hidden;
  }

  .wild-grid-products__link {
    display: block;
    position: relative;
    text-decoration: none;
    color: inherit;
  }

  .wild-grid-products__image {
    width: 100%;
    aspect-ratio: 4 / 4.4;
    object-fit: cover;
    display: block;
    transform: scale(1);
    transition: transform 0.3s ease;
  }

  .wild-grid-products__plus {
    position: absolute;
    top: 52%;
    left: 62%;
    transform: translate(-50%, -50%);
    width: 30px;
    height: 30px;
    border-radius: 999px;
    background: #f3f3f3;
    color: #111;
    font-size: 22px;
    line-height: 30px;
    text-align: center;
    box-shadow: 0 1px 6px rgba(0, 0, 0, 0.2);
    pointer-events: none;
  }

  .wild-grid-products__link:hover .wild-grid-products__image {
    transform: scale(1.03);
  }

  .wild-grid-products__item--empty .wild-grid-products__image {
    opacity: 0.55;
  }

  .js-wild-grid-item {
    opacity: 0;
    transform: translateY(12px);
    transition: opacity 0.35s ease, transform 0.35s ease;
  }

  .js-wild-grid-item.is-inview {
    opacity: 1;
    transform: translateY(0);
  }

  @media (max-width: 767px) {
    .wild-grid-products {
      padding: 30px 0;
    }

    .wild-grid-products__container {
      width: calc(100% - 24px);
    }

    .wild-grid-products__heading {
      margin-bottom: 16px;
      font-size: clamp(26px, 8vw, 40px);
    }

    .wild-grid-products__grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
      grid-template-rows: repeat(3, auto);
      gap: 10px;
    }

    .wild-grid-products__plus {
      width: 26px;
      height: 26px;
      line-height: 26px;
      font-size: 20px;
    }
  }
</style>

<script>
  (function () {
    var root = document.querySelector('.js-wild-grid-products');
    if (!root) return;

    var items = root.querySelectorAll('.js-wild-grid-item');
    if (!items.length) return;

    var observer = new IntersectionObserver(function (entries) {
      entries.forEach(function (entry) {
        if (entry.isIntersecting) {
          entry.target.classList.add('is-inview');
          observer.unobserve(entry.target);
        }
      });
    }, { threshold: 0.2 });

    items.forEach(function (item) {
      observer.observe(item);
    });
  })();
</script>

{% schema %}
{
  "name": "Wild Grid Products (Auto)",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Tisso vison in the wild"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "First 6 products from this collection will be shown automatically."
    }
  ],
  "presets": [
    {
      "name": "Wild Grid Products (Auto)"
    }
  ]
}
{% endschema %}
